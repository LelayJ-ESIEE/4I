#include <signal.h>
#include <sys/types.h>
#include "../include/gestionFichiers.h"

void handler(int i){
    ecritLigne("Too late: vault closed", 1);
    exit(1);
}

int main(){
    pid_t r;
    int kv;

    /* fork */
    r = fork();
    if(r == -1){
        perror("error while forking");
        exit(1);
    }
    /* parent : */
    if(r != 0){
        char* s;
        signal(SIGUSR1, *handler);
        s = litLigne(0);
        if(!strcmp(s, "1234")){
            ecritLigne("Congrats: vault opened", 1);
            signal(SIGUSR1, SIG_IGN);
        }
        else{
            ecritLigne("Wrong password: vault closed", 1);
        }

        kv = kill(r, SIGKILL);
        if(kv == -1){
            perror("error on kill in parent");
            return -1;
        }
    }

    /* child */
    else{
        int ppid = getppid();
        sleep(10);
        kv = kill(ppid, SIGUSR1);
        if(kv == -1){
            perror("error on kill in child");
            return -1;
        }
    }

    return 0;
}
